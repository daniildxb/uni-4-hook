type Protocol @entity(immutable: false) {
  id: ID!
  name: String!
  pools: [Pool!]! @derivedFrom(field: "protocol")
  totalValueLockedUSD: BigDecimal!
  cumulativeFeeUSD: BigDecimal!
  snapshots: [ProtocolHourlySnapshots!]! @derivedFrom(field: "protocol")
}

type ProtocolHourlySnapshots @entity(immutable: true) {
  id: ID!
  protocol: Protocol!
  totalValueLockedUSD: BigDecimal!
  cumulativeFeeUSD: BigDecimal!
}

type Pool @entity(immutable: false) {
  id: ID!
  protocol: Protocol!
  hook: Bytes!
  token0: Token!
  token1: Token!
  tickSpacing: BigInt!
  fee: BigInt!
  currentPrice: BigInt!
  token0AmountPerShare: BigDecimal!
  token1AmountPerShare: BigDecimal!
  totalValueLockedUSD: BigDecimal!
  cumulativeSwapFeeUSD: BigDecimal!
  cumulativeLendingYieldUSD: BigDecimal!
  deposits: [Deposit!]! @derivedFrom(field: "pool")
  withdrawals: [Withdrawal!]! @derivedFrom(field: "pool")
  swaps: [Swap!]! @derivedFrom(field: "pool")
  positions: [Position!]! @derivedFrom(field: "pool")
  snapshots: [PoolHourlySnapshots!]! @derivedFrom(field: "pool")
  createdAtTimestamp: BigInt!
  createdAtBlockNumber: BigInt!
  updatedAtTimestamp: BigInt!
  updatedAtBlockNumber: BigInt!
}

type PoolHourlySnapshots @entity(immutable: true) {
  id: ID!
  pool: Pool!
  totalValueLockedUSD: BigDecimal!
  cumulativeSwapFeeUSD: BigDecimal!
  cumulativeLendingYieldUSD: BigDecimal!
}

type Token @entity(immutable: true) {
  id: ID!
  symbol: String!
  name: String!
  decimals: Int!
}

type Account @entity(immutable: true) {
  id: ID!
  positions: [Position!]! @derivedFrom(field: "account")
}

type Position @entity(immutable: false) {
  id: ID!
  account: Account!
  pool: Pool!
  # liquidity
  shares: BigInt!
  deposits: [Deposit!]! @derivedFrom(field: "position")
  withdrawals: [Withdrawal!]! @derivedFrom(field: "position")
  transfers: [Transfer!]! @derivedFrom(field: "position")
  createdAtTimestamp: BigInt!
  createdAtBlockNumber: BigInt!
  updatedAtTimestamp: BigInt!
  updatedAtBlockNumber: BigInt!
}

type Deposit @entity(immutable: true) {
  id: ID!
  account: Account!
  pool: Pool!
  position: Position!
  token0Amount: BigInt!
  token1Amount: BigInt!
  shares: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
}

type Withdrawal @entity(immutable: true) {
  id: ID!
  account: Account!
  pool: Pool!
  position: Position!
  token0Amount: BigInt!
  token1Amount: BigInt!
  shares: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
}

# todo: implement handlers
type Transfer @entity(immutable: true) {
  id: ID!
  sender: Account!
  receiver: Account!
  pool: Pool!
  position: Position!
  token0Amount: BigInt!
  token1Amount: BigInt!
  shares: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
}

type Swap @entity(immutable: true) {
  id: ID!
  pool: Pool!
  # delta of amounts of the pool
  # when swapping 0 -> 1, amount0 is negative and amount1 is positive
  amount0: BigInt!
  amount1: BigInt!
  # fees paid in the input token (the one that's negative)
  fee: BigInt!
  sender: Bytes!
  timestamp: BigInt!
  blockNumber: BigInt!
}
